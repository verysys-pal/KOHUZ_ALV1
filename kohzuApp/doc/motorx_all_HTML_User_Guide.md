# π Kohzu Motor Web Control Guide (`motorx_all.html`)

## 1. κ°μ” (Overview)
`motorx_all.html`μ€ Kohzu λ¨ν„° μ»¨νΈλ΅¤λ¬λ¥Ό μ›Ή λΈλΌμ°μ €(Chrome, Safari λ“±)λ¥Ό ν†µν•΄ μ›κ²©μΌλ΅ μ μ–΄ν•κ³  λ¨λ‹ν„°λ§ν•κΈ° μ„ν• μΈν„°νμ΄μ¤μ…λ‹λ‹¤. EPICS Web Gatewayμ™€ WebSocket ν†µμ‹ μ„ μ‚¬μ©ν•μ—¬ μ‹¤μ‹κ°„ λ°μ΄ν„°λ¥Ό μ£Όκ³ λ°›μµλ‹λ‹¤.

## 2. μ ‘μ† λ°©λ²• (Connection)

### 2.1 μ„λ²„ μ‹¤ν–‰ (Server Start)
PCμ—μ„ Gateway μ„λ²„κ°€ μ‹¤ν–‰ μ¤‘μ΄μ–΄μ•Ό ν•©λ‹λ‹¤.
```bash
cd /usr/local/epics/EPICS_R7.0/siteApp/KOHUZ_ALV1/kohzuApp/opi
python3 web_gateway.py
```

### 2.2 λΈλΌμ°μ € μ ‘μ† (Browser Access)
PC λλ” λ¨λ°”μΌ κΈ°κΈ°μ μ›Ή λΈλΌμ°μ € μ£Όμ†μ°½μ— λ‹¤μ ν•μ‹μΌλ΅ μ ‘μ†ν•©λ‹λ‹¤.
- **URL ν•μ‹:** `http://<PC_IP_ADDRESS>:8888/motorx_all.html`
- **μμ‹ (λ‚΄λ¶€λ§):** `http://192.168.97.37:8888/motorx_all.html`
- **μμ‹ (μ™Έλ¶€λ§):** `http://192.168.1.100:8888/motorx_all.html`

> **μ°Έκ³ :** μ ‘μ† μ‹ μƒλ‹¨ **Status** ν‘μ‹λ“±μ΄ <span style="color:green">β— Connected</span>λ΅ λ‚νƒ€λ‚μ•Ό μ •μƒμ…λ‹λ‹¤.

---

## 3. μΈν„°νμ΄μ¤ κµ¬μ„± (Interface Layout)

### 3.1 μƒλ‹¨ λ°” (Header)
- **Status Indicator**: μ„λ²„μ™€μ μ—°κ²° μƒνƒλ¥Ό ν‘μ‹ν•©λ‹λ‹¤. (Connected / Disconnected)
- **PV Prefix**: ν„μ¬ μ μ–΄ μ¤‘μΈ λ¨ν„°μ PV μ ‘λ‘μ‚¬λ¥Ό ν‘μ‹ν•©λ‹λ‹¤. (μ: `KOHZU:m1`)
- **ABORT ALL λ²„νΌ**: λΉ„μƒμ‹ λ¨λ“  λ™μ‘μ„ μ¦‰μ‹ μ¤‘μ§€ν•©λ‹λ‹¤. (`allstop.VAL` = 1)

### 3.2 Drive & Position μΉ΄λ“ (ν•µμ‹¬ μ μ–΄)
κ°€μ¥ λ§μ΄ μ‚¬μ©λλ” μ΄λ™ λ° μ •μ§€ κΈ°λ¥μ„ λ‹΄κ³  μμµλ‹λ‹¤.

1.  **READBACK VALUE (RBV)**
    - λ¨ν„°μ ν„μ¬ μ‹¤μ  μ„μΉλ¥Ό νΌμ§ν•κ² ν‘μ‹ν•©λ‹λ‹¤.
    - μ΄λ™ μ¤‘μ—λ” λ°°κ²½μ— μ• λ‹λ©”μ΄μ… ν¨κ³Όκ°€ λ‚νƒ€λ‚©λ‹λ‹¤.

2.  **Target Position (VAL)**
    - μ΄λ™ν•κ³ μ ν•λ” λ©ν‘ μ„μΉλ¥Ό μ…λ ¥ν•©λ‹λ‹¤.
    - **MOVE λ²„νΌ**: μ…λ ¥ν• μ„μΉλ΅ μ΄λ™ λ…λ Ήμ„ λ‚΄λ¦½λ‹λ‹¤.
    - **STOP λ²„νΌ**: ν„μ¬ μ§„ν–‰ μ¤‘μΈ μ΄λ™μ„ μ¦‰μ‹ μ¤‘λ‹¨ν•©λ‹λ‹¤.

3.  **Interactive Control (Tweak & Jog)**
    - **Step Size (TWV)**: Tweak μ΄λ™ κ±°λ¦¬λ¥Ό μ„¤μ •ν•©λ‹λ‹¤.
    - **Tweak +/- (TWR/TWF)**: μ„¤μ •λ Step Sizeλ§νΌ μƒλ€ μ΄λ™ν•©λ‹λ‹¤.
    - **Jog +/- (JOGR/JOGF)**: λ²„νΌμ„ λ„λ¥΄κ³  μλ” λ™μ• μ—°μ†μΌλ΅ μ΄λ™ν•©λ‹λ‹¤. (λ²„νΌμ„ λ–Όλ©΄ μ •μ§€)

### 3.3 Scan Control μΉ΄λ“ (μ¤μΊ” μ μ–΄)
μ‹μ¤ν… μ¤μΊ” λ™μ‘μ„ μ μ–΄ν•©λ‹λ‹¤.

- **SPMG (Stop/Pause/Move/Go)**: μ¤μΊ” μ§„ν–‰ μƒνƒλ¥Ό μ μ–΄ν•λ” λ²„νΌ κ·Έλ£Ήμ…λ‹λ‹¤.
    - **Stop**: μ¤μΊ” μ¤‘μ§€
    - **Pause**: μΌμ‹ μ •μ§€
    - **Move**: μ΄λ™ ν—μ© (μΌλ° μƒνƒ)
    - **Go**: μ¤μΊ” μ‹μ‘/μ¬κ°
- **Load Scan**: μ¤μΊ” νλΌλ―Έν„°λ¥Ό λ΅λ“ν•©λ‹λ‹¤.
- **Go Scan**: μ¤μΊ”μ„ μ‹¤ν–‰ν•©λ‹λ‹¤.

### 3.4 Motor Status μΉ΄λ“ (μƒνƒ λ¨λ‹ν„°λ§)
λ¨ν„°μ κ°μΆ… μƒνƒ λΉ„νΈμ™€ λ¦¬λ―ΈνΈ/μ—λ¬ μ—¬λ¶€λ¥Ό LED ν•νƒλ΅ ν‘μ‹ν•©λ‹λ‹¤.

- **State**: ν„μ¬ λ¨ν„°μ μƒνƒ (MOVING / IDLE).
- **Done (DMOV)**: μ΄λ™ μ™„λ£ μ—¬λ¶€. (μΌμ§ = μ™„λ£)
- **Hi-Limit (HLS)**: μƒν• λ¦¬λ―ΈνΈ λ„λ‹¬ μ—¬λ¶€. (λΉ¨κ°„μƒ‰ μ λ“± μ‹ μ„ν—)
- **Lo-Limit (LLS)**: ν•ν• λ¦¬λ―ΈνΈ λ„λ‹¬ μ—¬λ¶€. (λΉ¨κ°„μƒ‰ μ λ“± μ‹ μ„ν—)
- **Missed Steps (MISS)**: νƒμ΅° λ°μƒ μ—¬λ¶€.
- **Home Status (ATHM)**: μ›μ  λ³µκ·€ μ™„λ£ μ—¬λ¶€.
- **Communication (CNEN)**: μ»¨νΈλ΅¤λ¬ μ—°κ²° μƒνƒ.
- **Problem (SEVR)**: μ•λ λ“±κΈ‰ (MAJOR λ“±).

### 3.5 Dynamics μΉ΄λ“ (μ†λ„/κ°€μ†λ„)
- **Velocity (VELO)**: μ΄λ™ μ†λ„λ¥Ό μ„¤μ •ν•©λ‹λ‹¤. (λ‹¨μ„: mm/s)
- **Max Velocity (VMAX)**: μµλ€ ν—μ© μ†λ„.
- **Acceleration (ACCL)**: κ°€μ† μ‹κ°„. (μ΄ λ‹¨μ„)
- **Backlash**: λ°±λμ‰¬ λ³΄μ • κ±°λ¦¬ λ° μ†λ„ μ„¤μ •.

### 3.6 Soft Limits μΉ΄λ“ (μ†ν”„νΈ λ¦¬λ―ΈνΈ)
- **User Limits (HLM/LLM)**: μ‚¬μ©μκ°€ μ„¤μ •ν•λ” μ•μ „ λ¦¬λ―ΈνΈμ…λ‹λ‹¤.
- **Dial Limits (DHLM/DLLM)**: ν•λ“μ›¨μ–΄ κΈ°μ¤€ μ λ€ λ¦¬λ―ΈνΈμ…λ‹λ‹¤.

### 3.7 Calibration / Homing μΉ΄λ“
- **Set Position (SET)**: ν„μ¬ μ„μΉ μΆν‘λ¥Ό μ¬μ„¤μ •ν•©λ‹λ‹¤.
    - **Use**: μΈμ½”λ” κ°’μ„ κ·Έλ€λ΅ μ‚¬μ©.
    - **Set**: ν„μ¬ μ„μΉλ¥Ό κ°•μ λ΅ νΉμ • κ°’μΌλ΅ λ³€κ²½ (Calibration).
- **Home Fwd/Rev**: μ›μ  λ³µκ·€ λ…λ Ήμ„ μν–‰ν•©λ‹λ‹¤.
- **Direction (DIR)**: λ¨ν„° νμ „ λ°©ν–¥ λ°μ „ μ„¤μ •.

---

## 4. λ¨λ°”μΌ μ‚¬μ© κ°€μ΄λ“ (Mobile Usage)
`motorx_all.html`μ€ λ°μ‘ν• μ›Ή λ””μμΈ(Responsive Design)μ΄ μ μ©λμ–΄ μμ–΄ μ¤λ§νΈν°μ΄λ‚ νƒλΈ”λ¦Ώμ—μ„λ„ μµμ ν™”λ ν™”λ©΄μ„ μ κ³µν•©λ‹λ‹¤.

- **κ°€λ΅ λ¨λ“ κ¶μ¥**: νƒλΈ”λ¦Ώμ—μ„λ” κ°€λ΅ λ¨λ“λ΅ μ‚¬μ© μ‹ PCμ™€ μ μ‚¬ν• 4μ—΄ λ μ΄μ•„μ›ƒμ„ λ³Ό μ μμµλ‹λ‹¤.
- **ν„°μΉ μµμ ν™”**: λ²„νΌ ν¬κΈ°κ°€ μ†κ°€λ½ ν„°μΉμ— μµμ ν™”λμ–΄ μμµλ‹λ‹¤.
- **μ¤ν¬λ΅¤**: μ„Έλ΅ ν™”λ©΄μ—μ„λ” μΉ΄λ“κ°€ μμ§μΌλ΅ λ°°μΉλλ―€λ΅ μ¤ν¬λ΅¤ν•μ—¬ κ° μ„Ήμ…μ— μ ‘κ·Όν•μ„Έμ”.

## 5. λ¬Έμ  ν•΄κ²° (Troubleshooting)

### Q1. μ ‘μ†μ΄ λμ§€ μ•μ•„μ”. (`ERR_CONNECTION_REFUSED`)
- PCμ—μ„ `web_gateway.py`κ°€ μ‹¤ν–‰ μ¤‘μΈμ§€ ν™•μΈν•μ„Έμ”.
- PCμ λ°©ν™”λ²½(Firewall)μ—μ„ 8888λ² ν¬νΈκ°€ ν—μ©λμ–΄ μλ”μ§€ ν™•μΈν•μ„Έμ”.
- μ¤λ§νΈν°μ΄ PCμ™€ λ™μΌν• λ„¤νΈμ›ν¬(Wi-Fi λ“±)μ— μ—°κ²°λμ–΄ μλ”μ§€ ν™•μΈν•μ„Έμ”.

### Q2. κ°’μ€ λ³΄μ΄λ”λ° μ μ–΄κ°€ μ• λΌμ”.
- μƒλ‹¨ **Status**κ°€ **Disconnected**μΈμ§€ ν™•μΈν•μ„Έμ”.
- **SPMG** λ²„νΌμ΄ **Stop** λλ” **Pause** μƒνƒμΈμ§€ ν™•μΈν•μ„Έμ”. (**Move** λλ” **Go**μ—¬μ•Ό μ΄λ™ κ°€λ¥)
- λ¦¬λ―ΈνΈ(HLS/LLS)κ°€ μΌμ Έ μλ”μ§€ ν™•μΈν•μ„Έμ”.

### Q3. ν™”λ©΄μ΄ κΉ¨μ Έ λ³΄μ—¬μ”.
- λΈλΌμ°μ € μΊμ‹λ¥Ό μ§€μ°κ³  μƒλ΅κ³ μΉ¨(F5) ν•μ„Έμ”.
- μµμ‹  λ²„μ „μ Chrome λλ” Safari λΈλΌμ°μ € μ‚¬μ©μ„ κ¶μ¥ν•©λ‹λ‹¤.
